{% extends '_base.html' %}
{% load static %}

{% block title %}My Favorites{% endblock %}

{% block content %}
<div class="relative min-h-screen bg-gray-1000 bg-cover bg-center" style="background-image: url('{% static "images/background.jpg" %}');">
    <div class="bg-gray-900 bg-opacity-80 p-8 min-h-screen">
        <h2 class="text-5xl font-extrabold text-white mb-10 text-center">My Favorites</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
            {% for favorite in favorites %}
            <div class="group relative bg-gradient-to-br from-gray-800 via-gray-900 to-red-900 rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300">
                <img src="{% static 'images/' %}{{ favorite.movie.poster.url }}" alt="Favorite Movie {{ favorite.movie.title }}" class="w-full h-64 object-cover transition-transform duration-300 ease-in-out group-hover:scale-105">
                <div class="absolute top-0 right-0 bg-gray-700 bg-opacity-75 text-white p-2 rounded-bl-lg">
                    <p class="text-sm">Rating: {{ favorite.movie.rating }}</p>
                </div>
                <div class="p-6">
                    <h3 class="text-2xl font-semibold text-white">{{ favorite.movie.title }}</h3>
                    <p class="text-gray-400 mt-1 mb-4">Released: {{ favorite.movie.release_date }}</p>
                    <button class="remove-favorite-btn flex items-center justify-center bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition-all duration-200" data-movie-id="{{ favorite.movie.id }}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Remove from Favorites
                    </button>
                </div>
            </div>
            {% empty %}
            <p class="text-gray-500 text-center col-span-full">No favorites added yet.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock content %}

{% block script %}
<script>
    const removeFavoriteButtons = document.querySelectorAll('.remove-favorite-btn');
    removeFavoriteButtons.forEach(button => {
        button.addEventListener('click', function () {
            const movieId = this.getAttribute('data-movie-id');

            fetch('/remove_favorite/', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' 
                },
                body: JSON.stringify({ movie_id: movieId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.closest('.group').remove();
                    alert('Removed from favorites!');
                } else {
                    alert('Failed to remove from favorites.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred.');
            });
        });
    });
</script>
{% endblock script %}
